apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: vs-frontend
spec:
  gateways:
  - frontend-gateway
  hosts:
  - productcatalogservice.default.io
  http:
  - match:
    - headers:
       x-istio-cohort:
         exact: "internal"  
    route:
     - destination:
         host: frontend
         subset: version-v1
  - route:
    - destination:
        host: frontend
        subset: version-v2
    retries:
      attempts: 3
      retryOn: 5xx
      perTryTimeout: 2s
